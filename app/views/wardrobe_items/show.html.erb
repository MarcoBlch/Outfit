<%= turbo_frame_tag "modal" do %>
  <%= render "shared/modal" do %>
    <div class="flex flex-col sm:flex-row gap-8">
      <!-- Image Section -->
      <div class="w-full sm:w-1/2">
        <div class="aspect-square rounded-xl overflow-hidden bg-black/20 flex items-center justify-center border border-white/5">
          <% if @wardrobe_item.image.attached? %>
            <%= image_tag @wardrobe_item.image, class: "w-full h-full object-contain" %>
          <% else %>
            <span class="text-gray-500">No Image</span>
          <% end %>
        </div>
      </div>

      <!-- Details/Edit Section -->
      <div class="w-full sm:w-1/2 flex flex-col" data-controller="edit-mode">
        <!-- Display Mode -->
        <div data-edit-mode-target="display" class="flex-1">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-white"><%= @wardrobe_item.category&.titleize || "Uncategorized" %></h2>
            <button type="button" data-action="edit-mode#edit" class="text-primary hover:text-primary-light text-sm font-medium">
              Edit Details
            </button>
          </div>

          <div class="space-y-6">
            <div>
              <label class="block text-xs font-medium text-gray-500 uppercase tracking-wider mb-1">Color</label>
              <div class="flex items-center space-x-2">
                <div class="w-4 h-4 rounded-full border border-white/20" style="background-color: <%= @wardrobe_item.color %>;"></div>
                <span class="text-white"><%= @wardrobe_item.color&.titleize || "Unknown" %></span>
              </div>
            </div>

            <div>
              <label class="block text-xs font-medium text-gray-500 uppercase tracking-wider mb-1">Tags</label>
              <div class="flex flex-wrap gap-2">
                <% ((@wardrobe_item.metadata || {})["tags"] || []).each do |tag| %>
                  <span class="px-2 py-1 bg-white/5 rounded text-sm text-gray-300 border border-white/10"><%= tag %></span>
                <% end %>
              </div>
            </div>

            <div>
              <label class="block text-xs font-medium text-gray-500 uppercase tracking-wider mb-1">Description</label>
              <p class="text-gray-300 text-sm leading-relaxed">
                <%= (@wardrobe_item.metadata || {})["description"] || "No description available." %>
              </p>
            </div>
          </div>
          
          <div class="mt-auto pt-8 flex justify-end">
               <%= button_to wardrobe_item_path(@wardrobe_item), method: :delete, class: "text-red-400 hover:text-red-300 text-sm flex items-center gap-2 transition-colors", form: { data: { turbo_confirm: "Are you sure you want to delete this item?", turbo_frame: "_top" } } do %>
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                  Delete Item
               <% end %>
          </div>
        </div>

        <!-- Edit Mode (Hidden by default) -->
        <div data-edit-mode-target="form" class="hidden flex-1">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-white">Edit Item</h2>
            <button type="button" data-action="edit-mode#cancel" class="text-gray-400 hover:text-white text-sm font-medium">
              Cancel
            </button>
          </div>

          <%= form_with model: @wardrobe_item, class: "space-y-4" do |f| %>
            <div>
              <%= f.label :category, class: "block text-sm font-medium text-gray-400 mb-1" %>
              <%= f.select :category, 
                  ["Tops", "Bottoms", "Shoes", "Outerwear", "Accessories", "Dresses"].map { |c| [c, c.downcase] }, 
                  {}, 
                  class: "w-full bg-black/20 border border-white/10 rounded-lg text-white focus:ring-primary focus:border-primary" %>
            </div>

            <div>
              <%= f.label :color, class: "block text-sm font-medium text-gray-400 mb-1" %>
              <%= f.text_field :color, class: "w-full bg-black/20 border border-white/10 rounded-lg text-white focus:ring-primary focus:border-primary" %>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-400 mb-1">Tags (comma separated)</label>
              <input type="text" 
                     name="wardrobe_item[metadata][tags]" 
                     value="<%= ((@wardrobe_item.metadata || {})['tags'] || []).join(', ') %>"
                     class="w-full bg-black/20 border border-white/10 rounded-lg text-white focus:ring-primary focus:border-primary">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-400 mb-1">Description</label>
              <textarea name="wardrobe_item[metadata][description]" 
                        rows="4"
                        class="w-full bg-black/20 border border-white/10 rounded-lg text-white focus:ring-primary focus:border-primary"><%= (@wardrobe_item.metadata || {})['description'] %></textarea>
            </div>

            <div class="pt-4 flex justify-end">
              <%= f.submit "Save Changes", class: "px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg font-medium transition-colors" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
<% end %>
