<div id="quiz-complete-modal"
     class="relative z-50"
     aria-labelledby="modal-title"
     role="dialog"
     aria-modal="true"
     data-controller="quiz-complete">

  <!-- Background backdrop -->
  <div class="fixed inset-0 bg-gray-900/90 backdrop-blur-sm transition-opacity duration-300 opacity-100"></div>

  <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
    <div class="flex min-h-full items-center justify-center p-4">
      <!-- Modal panel -->
      <div class="relative transform overflow-hidden rounded-2xl bg-gradient-to-br from-gray-900 via-purple-900/20 to-gray-900 border border-purple-500/30 text-left shadow-2xl shadow-purple-600/20 transition-all duration-300 opacity-100 scale-100 w-full max-w-2xl">

        <div class="px-8 py-12">
          <!-- Analysis Phase -->
          <div data-quiz-complete-target="analysisPhase" class="text-center space-y-8">
            <!-- Animated Icon -->
            <div class="flex justify-center">
              <div class="relative">
                <!-- Outer rotating ring -->
                <div class="absolute inset-0 animate-spin-slow">
                  <svg class="w-32 h-32 text-purple-600" fill="none" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-dasharray="3 3" opacity="0.3"/>
                  </svg>
                </div>

                <!-- Middle pulsing circle -->
                <div class="absolute inset-0 flex items-center justify-center animate-pulse">
                  <div class="w-24 h-24 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full opacity-20"></div>
                </div>

                <!-- Center icon -->
                <div class="relative flex items-center justify-center w-32 h-32">
                  <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-purple-600 to-pink-600 rounded-full">
                    <svg class="w-10 h-10 text-white animate-bounce-subtle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                    </svg>
                  </div>
                </div>
              </div>
            </div>

            <!-- Title -->
            <h3 class="text-3xl font-bold text-white">
              Analyzing Your Style Profile
            </h3>

            <!-- Progress Messages -->
            <div class="space-y-2 min-h-[60px]">
              <p data-quiz-complete-target="message" class="text-lg text-gray-300 font-medium animate-fade-in">
                Processing your preferences...
              </p>
              <div class="flex justify-center space-x-2">
                <span class="inline-block w-2 h-2 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 0ms;"></span>
                <span class="inline-block w-2 h-2 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 150ms;"></span>
                <span class="inline-block w-2 h-2 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 300ms;"></span>
              </div>
            </div>
          </div>

          <!-- Success Phase (hidden initially) -->
          <div data-quiz-complete-target="successPhase" class="hidden text-center space-y-6">
            <!-- Success Icon with scale animation -->
            <div class="flex justify-center">
              <div class="inline-flex items-center justify-center w-24 h-24 bg-green-600/20 rounded-full animate-scale-in">
                <svg class="w-12 h-12 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                </svg>
              </div>
            </div>

            <!-- Title -->
            <div class="space-y-3">
              <h3 class="text-3xl font-bold text-white">
                Profile Complete!
              </h3>
              <p class="text-lg text-gray-300">
                <%= message %>
              </p>
            </div>

            <!-- Style Summary -->
            <% if defined?(summary_items) && summary_items %>
              <div class="grid grid-cols-2 gap-3 pt-4">
                <% summary_items.each do |item| %>
                  <div class="p-4 bg-gray-800/50 border border-gray-700 rounded-xl">
                    <div class="text-3xl mb-2"><%= item[:icon] %></div>
                    <div class="text-xs text-gray-500 uppercase tracking-wide"><%= item[:label] %></div>
                    <div class="text-sm text-white font-medium mt-1"><%= item[:value] %></div>
                  </div>
                <% end %>
              </div>
            <% end %>

            <!-- Continue Button -->
            <div class="pt-6">
              <button type="button"
                      onclick="redirectToDashboard()"
                      class="inline-flex items-center space-x-2 px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold text-lg rounded-xl shadow-lg shadow-purple-600/30 hover:shadow-purple-600/50 transition-all duration-200 transform hover:scale-105">
                <span>Explore Your Dashboard</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const quizCompleteRedirectUrl = "<%= j redirect_path %>";
  const analysisMessages = [
    "Processing your preferences...",
    "Analyzing color palette...",
    "Understanding your style...",
    "Building your profile...",
    "Creating recommendations..."
  ];

  let messageIndex = 0;
  let messageInterval;

  // Cycle through analysis messages
  function updateAnalysisMessage() {
    const messageEl = document.querySelector('[data-quiz-complete-target="message"]');
    if (messageEl && messageIndex < analysisMessages.length) {
      messageEl.style.opacity = '0';
      setTimeout(() => {
        messageEl.textContent = analysisMessages[messageIndex];
        messageEl.style.opacity = '1';
        messageIndex++;
      }, 200);
    }
  }

  // Start cycling messages
  messageInterval = setInterval(updateAnalysisMessage, 1200);

  // Show success phase after analysis
  setTimeout(() => {
    clearInterval(messageInterval);

    const analysisPhase = document.querySelector('[data-quiz-complete-target="analysisPhase"]');
    const successPhase = document.querySelector('[data-quiz-complete-target="successPhase"]');

    if (analysisPhase && successPhase) {
      analysisPhase.style.opacity = '0';
      setTimeout(() => {
        analysisPhase.classList.add('hidden');
        successPhase.classList.remove('hidden');
        successPhase.style.opacity = '0';
        setTimeout(() => {
          successPhase.style.opacity = '1';
        }, 50);
      }, 300);
    }
  }, 6000); // Show analysis for 6 seconds

  // Redirect function
  function redirectToDashboard() {
    if (quizCompleteRedirectUrl) {
      if (window.Turbo && window.Turbo.visit) {
        window.Turbo.visit(quizCompleteRedirectUrl);
      } else {
        window.location.href = quizCompleteRedirectUrl;
      }
    }
  }

  // Auto-redirect after showing success for 4 seconds
  setTimeout(() => {
    redirectToDashboard();
  }, 10000); // 6s analysis + 4s success
</script>

<style>
  @keyframes spin-slow {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  @keyframes bounce-subtle {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  @keyframes scale-in {
    0% { transform: scale(0); opacity: 0; }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); opacity: 1; }
  }

  @keyframes fade-in-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-spin-slow {
    animation: spin-slow 3s linear infinite;
  }

  .animate-bounce-subtle {
    animation: bounce-subtle 2s ease-in-out infinite;
  }

  .animate-scale-in {
    animation: scale-in 0.5s ease-out forwards;
  }

  .animate-fade-in {
    transition: opacity 0.3s ease-in-out;
  }

  [data-quiz-complete-target="successPhase"] {
    transition: opacity 0.5s ease-in-out;
  }

  [data-quiz-complete-target="analysisPhase"] {
    transition: opacity 0.3s ease-in-out;
  }
</style>
